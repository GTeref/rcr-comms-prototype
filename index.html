<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROSBridge Websocket Test</title>
</head>
<body>
    <h1>Rosbridge demo</h1>
    <h2>How to connect:</h2>
    <ul>
        <li>Start rosbridge server by entering <code>ros2 launch rosbridge_server rosbridge_websocket_launch.xml</code> inside terminal</li>
        <li>Server should run at port 9090 by default</li>
        <li>Push messages to webpage by opening new terminal and entering messages in the format: 
            <code>ros2 topic pub /my_topic std_msgs/String "data: 'Hello world!' -1</code></li>
    </ul>
    <p>Connection status: 
        <span id="status"
            style="font-weight: bold;">
            N/A
        </span>
    </p>
    <p><code>/my_topic/</code> messages received:
        <ul id="messages"
            style="font-weight: bold;">
        </ul>
    </p>
    <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script type="text/javascript" type="text/javascript">
        const ros = new ROSLIB.Ros({
            url: "ws://localhost:9090"
        });

        ros.on('connection', () => {
            document.getElementById('status').innerHTML = "successful";
        });

        ros.on('error', (error) => {
            document.getElementById('status').innerHTML = "errored out " + error;
        });

        ros.on('close', () => {
            document.getElementById('status').innerHTML = "closed";
        });

        const topicListener = new ROSLIB.TOPIC({
            ros,
            name: '/my_topic/',
            messageType: 'std_msgs/String',
        });

        topicListener.subscribe((msg) => {
            const messageList = document.getElementById('messages');
            const newMessage = document.createElement('li');
            newMessage.appendChild(document.createTextNode(msg.data));
            messageList.appendChild(newMessage);
        });
    </script>
</body>
</html>